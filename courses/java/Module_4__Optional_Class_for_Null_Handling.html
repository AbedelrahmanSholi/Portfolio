<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../css/courses/comprehensive_course_styling.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 4: Optional Class for Null Handling</title>
    <!-- Base styles -->
    <link href="/css/general_root.css" rel="stylesheet" />
    <link href="/css/background_effect.css" rel="stylesheet" />
    
    <!-- Consolidated hover and z-index styles - loaded early to establish hierarchy -->
    <link href="/css/z_index_system.css" rel="stylesheet" />
    <link href="/css/hover_fix_comprehensive.css" rel="stylesheet" />
    <link href="/css/tooltip_hover.css" rel="stylesheet" />
    
    <!-- Component styles -->
    <link href="/css/slider.css" rel="stylesheet" />
    <link href="/css/enhanced_components.css" rel="stylesheet" />
    <link href="/css/skills_alternative.css" rel="stylesheet" />
    <link href="/css/timeline.css" rel="stylesheet" />
    <link href="/css/project_showcase_fixed.css" rel="stylesheet" />
    <link href="/css/technical_skills_fixed.css" rel="stylesheet" />
    
    <!-- Fixes and enhancements -->
    <link href="/css/mobile_responsive.css" rel="stylesheet" />
    <link href="/css/design_fixes.css" rel="stylesheet" />
    <link href="/css/skills_icons_fix.css" rel="stylesheet" />
    <link href="/css/layout_fixes.css" rel="stylesheet" />
    <link href="/css/contact_fix.css" rel="stylesheet" />
    <link href="/css/final_fixes.css" rel="stylesheet" />
    
    <!-- External resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Courses section styles -->
    <link href="/css/courses/courses.css" rel="stylesheet" />
    <link href="/css/courses/enhanced_course_styling.css" rel="stylesheet" />
    
    <!-- Syntax highlighting for code blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/atom-one-dark.min.css">
</head>

<body>
    <div class="course-content-wrapper">
        <div class="module-navigation">
            <a href="Module_3__Stream_API_and_Collections.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Stream API and Collections
            </a>
            <a href="Module_5__CompletableFuture_for_Asynchronous_Operations.html" class="nav-btn next-btn">
                Next: CompletableFuture for Asynchronous Operations <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <h1 id="module-4-optional-class-for-null-handling">Module 4: Optional Class for Null Handling</h1>

        <h2 id="learning-objectives">Learning Objectives</h2>
        <ul>
            <li>Understand the purpose and benefits of the Optional class</li>
            <li>Create and use Optional objects effectively</li>
            <li>Apply Optional in test data handling and validation</li>
            <li>Combine Optional with streams for powerful data processing</li>
            <li>Implement best practices for Optional usage in test automation</li>
        </ul>

        <h2 id="41-introduction-to-the-optional-class">4.1 Introduction to the Optional Class</h2>

        <h3 id="the-problem-with-null">The Problem with Null</h3>
        <p>Null references have long been a source of errors in Java applications:</p>
        <ol>
            <li><strong>NullPointerException</strong>: The most common runtime exception in Java</li>
            <li><strong>Ambiguous meaning</strong>: Null can mean absence of value, error condition, or uninitialized state</li>
            <li><strong>Silent failures</strong>: Null can propagate through a system, causing failures far from the source</li>
            <li><strong>No type safety</strong>: The compiler cannot help prevent null-related errors</li>
        </ol>

        <p>In test automation, null-related issues are particularly problematic:</p>
        <ul>
            <li>Test data may be incomplete or missing</li>
            <li>API responses might have null fields</li>
            <li>UI elements might not be present</li>
            <li>Test configurations could have missing values</li>
        </ul>

        <h3 id="how-optional-solves-the-problem">How Optional Solves the Problem</h3>
        <p>Optional provides a container object that:</p>
        <ol>
            <li><strong>Makes absence explicit</strong>: Clearly communicates that a value might be absent</li>
            <li><strong>Forces handling</strong>: Requires explicit handling of the absent case</li>
            <li><strong>Provides utility methods</strong>: Offers convenient methods for common null-handling patterns</li>
            <li><strong>Integrates with streams</strong>: Works seamlessly with the Streams API</li>
        </ol>

        <h2 id="42-creating-and-using-optional">4.2 Creating and Using Optional</h2>

        <h3 id="creating-optional-objects">Creating Optional Objects</h3>
        <pre><code>// Creating an empty Optional
Optional&lt;String&gt; empty = Optional.empty();

// Creating Optional with a non-null value
Optional&lt;String&gt; present = Optional.of("Hello World");

// Creating Optional that might be null
String nullableValue = getValue(); // might return null
Optional&lt;String&gt; nullable = Optional.ofNullable(nullableValue);

// Test automation example
Optional&lt;WebElement&gt; element = findElementSafely(By.id("submit-button"));
</code></pre>

        <h3 id="checking-for-presence">Checking for Presence</h3>
        <pre><code>@Test
public void testOptionalPresence() {
    Optional&lt;String&gt; value = Optional.of("test");
    
    // Check if value is present
    assertTrue(value.isPresent());
    assertFalse(value.isEmpty()); // Java 11+
    
    // Get the value (throws exception if empty)
    String actualValue = value.get();
    assertEquals("test", actualValue);
    
    // Safe way to get value with default
    String result = value.orElse("default");
    assertEquals("test", result);
}
</code></pre>

        <h2 id="43-optional-methods-and-patterns">4.3 Optional Methods and Patterns</h2>

        <h3 id="conditional-execution">Conditional Execution</h3>
        <pre><code>@Test
public void testConditionalExecution() {
    Optional&lt;User&gt; user = findUser("testuser");
    
    // Execute action only if present
    user.ifPresent(u -> {
        System.out.println("User found: " + u.getName());
        validateUser(u);
    });
    
    // Execute different actions based on presence
    user.ifPresentOrElse(
        u -> System.out.println("User: " + u.getName()),
        () -> System.out.println("User not found")
    );
}
</code></pre>

        <h3 id="transformation-and-filtering">Transformation and Filtering</h3>
        <pre><code>@Test
public void testOptionalTransformation() {
    Optional&lt;String&gt; email = Optional.of("test@example.com");
    
    // Transform the value if present
    Optional&lt;String&gt; domain = email.map(e -> e.split("@")[1]);
    assertEquals("example.com", domain.orElse(""));
    
    // Filter based on condition
    Optional&lt;String&gt; validEmail = email.filter(e -> e.contains("@"));
    assertTrue(validEmail.isPresent());
    
    // Chain operations
    Optional&lt;String&gt; upperDomain = email
        .filter(e -> e.contains("@"))
        .map(e -> e.split("@")[1])
        .map(String::toUpperCase);
    
    assertEquals("EXAMPLE.COM", upperDomain.orElse(""));
}
</code></pre>

        <h2 id="44-optional-in-test-automation">4.4 Optional in Test Automation</h2>

        <h3 id="safe-element-finding">Safe Element Finding</h3>
        <pre><code>public class SafeWebDriver {
    private WebDriver driver;
    
    public Optional&lt;WebElement&gt; findElementSafely(By locator) {
        try {
            WebElement element = driver.findElement(locator);
            return Optional.of(element);
        } catch (NoSuchElementException e) {
            return Optional.empty();
        }
    }
    
    public Optional&lt;String&gt; getTextSafely(By locator) {
        return findElementSafely(locator)
            .filter(WebElement::isDisplayed)
            .map(WebElement::getText);
    }
}

@Test
public void testSafeElementInteraction() {
    SafeWebDriver safeDriver = new SafeWebDriver(driver);
    
    // Safe element interaction
    Optional&lt;WebElement&gt; submitButton = safeDriver.findElementSafely(By.id("submit"));
    
    submitButton.ifPresentOrElse(
        button -> {
            button.click();
            System.out.println("Button clicked successfully");
        },
        () -> fail("Submit button not found")
    );
    
    // Safe text extraction
    String welcomeMessage = safeDriver.getTextSafely(By.className("welcome"))
        .orElse("Welcome message not found");
    
    assertNotEquals("Welcome message not found", welcomeMessage);
}
</code></pre>

        <h3 id="test-data-handling">Test Data Handling</h3>
        <pre><code>public class TestDataManager {
    
    public Optional&lt;TestUser&gt; getTestUser(String environment) {
        Map&lt;String, TestUser&gt; users = loadTestUsers();
        return Optional.ofNullable(users.get(environment));
    }
    
    public Optional&lt;String&gt; getConfigValue(String key) {
        Properties config = loadConfiguration();
        return Optional.ofNullable(config.getProperty(key));
    }
}

@Test
public void testWithOptionalData() {
    TestDataManager dataManager = new TestDataManager();
    
    // Handle missing test data gracefully
    TestUser user = dataManager.getTestUser("staging")
        .orElseThrow(() -> new IllegalStateException("No test user for staging"));
    
    // Use configuration with fallback
    String baseUrl = dataManager.getConfigValue("base.url")
        .orElse("http://localhost:8080");
    
    // Conditional test execution
    dataManager.getConfigValue("enable.performance.tests")
        .filter("true"::equals)
        .ifPresent(value -> runPerformanceTests());
}
</code></pre>

        <h2 id="45-combining-optional-with-streams">4.5 Combining Optional with Streams</h2>

        <h3 id="filtering-and-mapping">Filtering and Mapping</h3>
        <pre><code>@Test
public void testOptionalWithStreams() {
    List&lt;String&gt; emails = Arrays.asList(
        "user1@example.com",
        null,
        "user2@test.com",
        "",
        "user3@domain.org"
    );
    
    // Filter out null/empty emails and extract domains
    List&lt;String&gt; domains = emails.stream()
        .map(Optional::ofNullable)
        .filter(Optional::isPresent)
        .map(Optional::get)
        .filter(email -> !email.isEmpty() && email.contains("@"))
        .map(email -> email.split("@")[1])
        .collect(Collectors.toList());
    
    assertEquals(3, domains.size());
    assertTrue(domains.contains("example.com"));
}
</code></pre>

        <h3 id="flatmap-with-optional">FlatMap with Optional</h3>
        <pre><code>public class UserService {
    public Optional&lt;User&gt; findUser(String id) {
        // Simulate database lookup
        return id != null && !id.isEmpty() 
            ? Optional.of(new User(id, "user@example.com"))
            : Optional.empty();
    }
    
    public Optional&lt;String&gt; getUserEmail(String userId) {
        return findUser(userId)
            .map(User::getEmail)
            .filter(email -> email.contains("@"));
    }
}

@Test
public void testFlatMapWithOptional() {
    UserService userService = new UserService();
    List&lt;String&gt; userIds = Arrays.asList("user1", null, "user2", "");
    
    // Get all valid user emails
    List&lt;String&gt; emails = userIds.stream()
        .map(userService::getUserEmail)
        .filter(Optional::isPresent)
        .map(Optional::get)
        .collect(Collectors.toList());
    
    assertEquals(2, emails.size());
}
</code></pre>

        <h2 id="46-best-practices-and-common-pitfalls">4.6 Best Practices and Common Pitfalls</h2>

        <h3 id="best-practices">Best Practices</h3>
        <ol>
            <li><strong>Use Optional as return type</strong>: Indicate that a method might not return a value</li>
            <li><strong>Avoid Optional.get()</strong>: Use orElse(), orElseGet(), or orElseThrow() instead</li>
            <li><strong>Don't use Optional for fields</strong>: Optional is not serializable and adds overhead</li>
            <li><strong>Use method chaining</strong>: Leverage map(), filter(), and flatMap() for clean code</li>
            <li><strong>Provide meaningful defaults</strong>: Use orElse() with sensible fallback values</li>
        </ol>

        <h3 id="common-pitfalls">Common Pitfalls</h3>
        <pre><code>// DON'T: Using Optional.get() without checking
Optional&lt;String&gt; value = getValue();
String result = value.get(); // Can throw NoSuchElementException

// DO: Use safe extraction methods
String result = value.orElse("default");
String result2 = value.orElseThrow(() -> new IllegalStateException("Value required"));

// DON'T: Creating Optional of Optional
Optional&lt;Optional&lt;String&gt;&gt; nested = Optional.of(Optional.of("value"));

// DO: Use flatMap to avoid nesting
Optional&lt;String&gt; flattened = getValue().flatMap(this::processValue);

// DON'T: Using Optional for collections
Optional&lt;List&lt;String&gt;&gt; optionalList = getList();

// DO: Return empty collection instead
List&lt;String&gt; list = getList().orElse(Collections.emptyList());
</code></pre>

        <h2 id="47-practical-exercises">4.7 Practical Exercises</h2>

        <h3 id="exercise-1-safe-configuration-reader">Exercise 1: Safe Configuration Reader</h3>
        <p>Create a configuration reader that safely handles missing properties:</p>
        <ol>
            <li>Create a ConfigurationReader class that uses Optional</li>
            <li>Implement methods to get string, integer, and boolean values</li>
            <li>Provide default values for missing configurations</li>
            <li>Add validation for configuration values</li>
            <li>Write tests to verify the behavior with missing and invalid values</li>
        </ol>

        <h3 id="exercise-2-optional-web-element-wrapper">Exercise 2: Optional Web Element Wrapper</h3>
        <p>Build a wrapper around WebDriver that uses Optional for safe element operations:</p>
        <ol>
            <li>Create methods that return Optional&lt;WebElement&gt;</li>
            <li>Implement safe click, sendKeys, and getText operations</li>
            <li>Add timeout handling with Optional</li>
            <li>Create fluent API for chaining operations</li>
            <li>Write comprehensive tests for all scenarios</li>
        </ol>

        <div class="module-navigation">
            <a href="Module_3__Stream_API_and_Collections.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Stream API and Collections
            </a>
            <a href="Module_5__CompletableFuture_for_Asynchronous_Operations.html" class="nav-btn next-btn">
                Next: CompletableFuture for Asynchronous Operations <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script src="/js/courses/mermaid_loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize Mermaid for diagram rendering
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ 
                    startOnLoad: true, 
                    theme: 'dark', 
                    securityLevel: 'loose',
                    themeVariables: {
                        primaryColor: '#3498db',
                        primaryTextColor: '#fff',
                        primaryBorderColor: '#1f77b4',
                        lineColor: '#f8f9fa',
                        secondaryColor: '#6c757d',
                        tertiaryColor: '#2c3e50'
                    }
                });
            }

            // Initialize syntax highlighting
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
            }
        });
    </script>
</body>
</html>

