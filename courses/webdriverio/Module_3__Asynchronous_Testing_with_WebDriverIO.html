<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../css/courses/comprehensive_course_styling.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 3: Asynchronous Testing with WebDriverIO</title>
    <!-- Base styles -->
    <link href="/css/general_root.css" rel="stylesheet" />
    <link href="/css/background_effect.css" rel="stylesheet" />
    
    <!-- Consolidated hover and z-index styles - loaded early to establish hierarchy -->
    <link href="/css/z_index_system.css" rel="stylesheet" />
    <link href="/css/hover_fix_comprehensive.css" rel="stylesheet" />
    <link href="/css/tooltip_hover.css" rel="stylesheet" />
    
    <!-- Component styles -->
    <link href="/css/slider.css" rel="stylesheet" />
    <link href="/css/enhanced_components.css" rel="stylesheet" />
    <link href="/css/skills_alternative.css" rel="stylesheet" />
    <link href="/css/timeline.css" rel="stylesheet" />
    <link href="/css/project_showcase_fixed.css" rel="stylesheet" />
    <link href="/css/technical_skills_fixed.css" rel="stylesheet" />
    
    <!-- Fixes and enhancements -->
    <link href="/css/mobile_responsive.css" rel="stylesheet" />
    <link href="/css/design_fixes.css" rel="stylesheet" />
    <link href="/css/skills_icons_fix.css" rel="stylesheet" />
    <link href="/css/layout_fixes.css" rel="stylesheet" />
    <link href="/css/contact_fix.css" rel="stylesheet" />
    <link href="/css/final_fixes.css" rel="stylesheet" />
    
    <!-- External resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Courses section styles -->
    <link href="/css/courses/courses.css" rel="stylesheet" />
    <link href="/css/courses/enhanced_course_styling.css" rel="stylesheet" />
    
    <!-- Syntax highlighting for code blocks -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/atom-one-dark.min.css">
</head>

<body>
    <div class="course-content-wrapper">
        <div class="module-navigation">
            <a href="Module_2__Selectors_and_Element_Interactions.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Selectors and Element Interactions
            </a>
            <a href="Module_4__Advanced_WebDriverIO_Features.html" class="nav-btn next-btn">
                Next: Advanced WebDriverIO Features <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <h1 id="module-3-asynchronous-testing-with-webdriverio">Module 3: Asynchronous Testing with WebDriverIO</h1>

        <h2 id="overview">Overview</h2>
        <p>This module explores asynchronous testing in WebDriverIO, a critical concept for creating reliable and efficient test automation. You'll learn how WebDriverIO handles asynchronous operations, how to work with promises and async/await, and how to implement effective asynchronous testing patterns.</p>

        <h2 id="learning-objectives">Learning Objectives</h2>
        <p>By the end of this module, you will be able to:</p>
        <ol>
            <li>Understand the asynchronous nature of WebDriverIO</li>
            <li>Implement tests using promises and async/await syntax</li>
            <li>Handle race conditions and timing issues in tests</li>
            <li>Implement synchronous-like test flows with asynchronous code</li>
            <li>Debug asynchronous test failures effectively</li>
            <li>Create custom asynchronous utilities for testing</li>
        </ol>

        <h2 id="31-understanding-asynchronous-testing">3.1 Understanding Asynchronous Testing</h2>
        <iframe sandbox="allow-scripts allow-same-origin" src="../resources/diagrams/async_testing.html" width="100%" height="500px" frameborder="0"></iframe>

        <h3 id="the-asynchronous-nature-of-web-testing">The Asynchronous Nature of Web Testing</h3>
        <p>Web testing is inherently asynchronous due to several factors:</p>
        <ol>
            <li><strong>Browser Interactions</strong>: Commands to the browser don't execute instantly</li>
            <li><strong>Network Requests</strong>: API calls, page loads, and resource fetching take time</li>
            <li><strong>Animations and Transitions</strong>: UI changes may involve animations</li>
            <li><strong>Dynamic Content</strong>: Content may load or change based on user actions</li>
            <li><strong>Backend Processing</strong>: Server-side operations affect what's displayed</li>
        </ol>

        <h3 id="synchronous-vs-asynchronous-code">Synchronous vs. Asynchronous Code</h3>
        <p>Understanding the difference between synchronous and asynchronous code:</p>
        <pre><code>// Synchronous code (executes line by line)
const result = 1 + 1;
console.log(result);
console.log('Done');

// Asynchronous code (doesn't wait for completion)
setTimeout(() => {
    console.log('This executes later');
}, 1000);
console.log('This executes first');
</code></pre>

        <h2 id="32-webdriverios-asynchronous-architecture">3.2 WebDriverIO's Asynchronous Architecture</h2>

        <h3 id="how-webdriverio-handles-asynchronous-operations">How WebDriverIO Handles Asynchronous Operations</h3>
        <p>WebDriverIO uses a client-server architecture where:</p>
        <ol>
            <li>Test script (client) sends commands to the WebDriver server</li>
            <li>WebDriver server executes commands in the browser</li>
            <li>Results are returned to the test script</li>
        </ol>
        <p>All WebDriverIO commands return promises, making them asynchronous by nature.</p>

        <h3 id="webdriverio-v7-and-asyncawait">WebDriverIO v7+ and Async/Await</h3>
        <p>Since version 7, WebDriverIO has fully embraced the async/await pattern:</p>
        <pre><code>// WebDriverIO v7+ with async/await
it('should demonstrate async/await', async () => {
    await browser.url('https://webdriver.io');
    const title = await browser.getTitle();
    expect(title).toContain('WebdriverIO');
});
</code></pre>

        <h2 id="33-working-with-promises-in-webdriverio">3.3 Working with Promises in WebDriverIO</h2>

        <h3 id="promise-basics">Promise Basics</h3>
        <p>A Promise in JavaScript represents a value that might not be available yet:</p>
        <pre><code>// Creating a promise
const myPromise = new Promise((resolve, reject) => {
    // Asynchronous operation
    setTimeout(() => {
        const success = true;
        if (success) {
            resolve('Operation completed successfully');
        } else {
            reject(new Error('Operation failed'));
        }
    }, 1000);
});

// Consuming a promise
myPromise
    .then(result => console.log(result))
    .catch(error => console.error(error));
</code></pre>

        <h3 id="promise-chaining">Promise Chaining</h3>
        <p>Promises can be chained to create a sequence of asynchronous operations:</p>
        <pre><code>// Promise chaining
browser.url('https://webdriver.io')
    .then(() => browser.getTitle())
    .then(title => {
        expect(title).toContain('WebdriverIO');
        return browser.getUrl();
    })
    .then(url => {
        expect(url).toContain('webdriver.io');
    })
    .catch(error => {
        console.error('Test failed:', error);
    });
</code></pre>

        <h2 id="34-asyncawait-in-webdriverio">3.4 Async/Await in WebDriverIO</h2>

        <h3 id="basic-asyncawait-syntax">Basic Async/Await Syntax</h3>
        <p>The async/await syntax makes asynchronous code look synchronous:</p>
        <pre><code>// Basic async/await syntax
it('should use async/await', async () => {
    // 'await' can only be used in 'async' functions
    await browser.url('https://webdriver.io');

    const title = await browser.getTitle();
    expect(title).toContain('WebdriverIO');

    const isDisplayed = await $('#header').isDisplayed();
    expect(isDisplayed).toBe(true);
});
</code></pre>

        <h3 id="error-handling-with-trycatch">Error Handling with Try/Catch</h3>
        <p>Use try/catch blocks to handle errors in async/await code:</p>
        <pre><code>// Error handling with try/catch
it('should handle errors with try/catch', async () => {
    try {
        await browser.url('https://webdriver.io');
        await $('#non-existent-element').click();
    } catch (error) {
        console.error('Test failed:', error);
        // You can also take screenshots, log additional info, etc.
        await browser.saveScreenshot('./error-screenshot.png');
        throw error; // Re-throw to fail the test
    }
});
</code></pre>

        <h2 id="35-handling-race-conditions-and-timing-issues">3.5 Handling Race Conditions and Timing Issues</h2>

        <h3 id="waiting-strategies">Waiting Strategies</h3>
        <p>Implement effective waiting strategies to handle timing issues:</p>
        <pre><code>// Explicit waits
it('should use explicit waits', async () => {
    await browser.url('/dynamic-page');

    // Wait for specific element
    await $('#dynamicElement').waitForDisplayed({ timeout: 5000 });

    // Wait for element to contain text
    await browser.waitUntil(async () => {
        return (await $('#status').getText()) === 'Ready';
    }, {
        timeout: 10000,
        timeoutMsg: 'Expected status to be Ready after 10s'
    });

    // Wait for URL to change
    await browser.waitUntil(async () => {
        return (await browser.getUrl()).includes('/ready');
    });
});
</code></pre>

        <h2 id="36-advanced-asynchronous-patterns">3.6 Advanced Asynchronous Patterns</h2>

        <h3 id="custom-async-utilities">Custom Async Utilities</h3>
        <p>Create reusable async utilities for common testing patterns:</p>
        <pre><code>// utils/async-helpers.js
class AsyncHelpers {
    /**
     * Waits for a condition to be true with polling
     */
    static async waitForCondition(condition, options = {}) {
        const {
            timeout = 10000,
            interval = 500,
            timeoutMsg = 'Condition not met within timeout'
        } = options;

        await browser.waitUntil(condition, { timeout, interval, timeoutMsg });
    }

    /**
     * Retries an operation until it succeeds or reaches max retries
     */
    static async retry(operation, options = {}) {
        const {
            maxRetries = 3,
            retryInterval = 500,
            retryCondition = (error) => true
        } = options;

        let lastError;

        for (let attempt = 1; attempt <= maxRetries; attempt++) {
            try {
                return await operation();
            } catch (error) {
                lastError = error;

                if (attempt < maxRetries && retryCondition(error)) {
                    await browser.pause(retryInterval);
                } else {
                    throw error;
                }
            }
        }
    }
}

module.exports = AsyncHelpers;
</code></pre>

        <h2 id="37-debugging-asynchronous-tests">3.7 Debugging Asynchronous Tests</h2>

        <h3 id="debugging-techniques">Debugging Techniques</h3>
        <p>Techniques for debugging asynchronous tests:</p>
        <pre><code>// Using browser.debug() to pause execution
it('should debug async test', async () => {
    await browser.url('/complex-page');

    // Pause execution for debugging
    await browser.debug();

    // Continue execution after manual debugging
    await $('#button').click();
});

// Using console.log with async values
it('should log async values', async () => {
    await browser.url('/page');

    const title = await browser.getTitle();
    console.log('Page title:', title);

    const element = await $('#element');
    const isDisplayed = await element.isDisplayed();
    console.log('Element displayed:', isDisplayed);
});
</code></pre>

        <h2 id="practical-exercises">Practical Exercises</h2>

        <h3 id="exercise-1-asynchronous-test-basics">Exercise 1: Asynchronous Test Basics</h3>
        <ol>
            <li>Create a test file that navigates to https://the-internet.herokuapp.com/dynamic_loading/1</li>
            <li>Implement a test that clicks the "Start" button and waits for the loading indicator to disappear</li>
            <li>Verify the hidden element is displayed</li>
            <li>Implement the same test using both Promise chains (.then()) and async/await</li>
            <li>Compare the readability and maintainability of both approaches</li>
        </ol>

        <h3 id="exercise-2-handling-race-conditions">Exercise 2: Handling Race Conditions</h3>
        <ol>
            <li>Create a test file that navigates to https://the-internet.herokuapp.com/dynamic_controls</li>
            <li>Implement proper waiting strategies to handle the dynamic nature of the page</li>
            <li>Test removing and adding checkboxes with proper synchronization</li>
        </ol>

        <h3 id="exercise-3-custom-async-utilities">Exercise 3: Custom Async Utilities</h3>
        <ol>
            <li>Create an async-helpers.js file with custom utility functions</li>
            <li>Implement waitForTextChange, retryClick, and waitForUrlToContain functions</li>
            <li>Use these utilities in your tests to make them more robust and readable</li>
        </ol>

        <h2 id="summary">Summary</h2>
        <p>In this module, you learned about asynchronous testing with WebDriverIO, including:</p>
        <ul>
            <li>The asynchronous nature of web testing and WebDriverIO's architecture</li>
            <li>Working with promises and async/await in WebDriverIO tests</li>
            <li>Handling race conditions and timing issues in asynchronous tests</li>
            <li>Implementing advanced asynchronous patterns and utilities</li>
            <li>Debugging asynchronous test failures effectively</li>
        </ul>

        <div class="module-navigation">
            <a href="Module_2__Selectors_and_Element_Interactions.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Selectors and Element Interactions
            </a>
            <a href="Module_4__Advanced_WebDriverIO_Features.html" class="nav-btn next-btn">
                Next: Advanced WebDriverIO Features <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script src="/js/courses/mermaid_loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize Mermaid for diagram rendering
            if (typeof mermaid !== 'undefined') {
                mermaid.initialize({ 
                    startOnLoad: true, 
                    theme: 'dark', 
                    securityLevel: 'loose',
                    themeVariables: {
                        primaryColor: '#3498db',
                        primaryTextColor: '#fff',
                        primaryBorderColor: '#1f77b4',
                        lineColor: '#f8f9fa',
                        secondaryColor: '#6c757d',
                        tertiaryColor: '#2c3e50'
                    }
                });
            }

            // Initialize syntax highlighting
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
            }
        });
    </script>
</body>
</html>

