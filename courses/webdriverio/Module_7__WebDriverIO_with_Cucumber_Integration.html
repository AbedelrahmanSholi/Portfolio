<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="../../css/courses/comprehensive_course_styling.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 7: WebDriverIO with Cucumber Integration</title>
    <link rel="stylesheet" href="../../css/courses/enhanced_course_styling.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
    <script src="../../js/courses/mermaid_loader.js"></script>
</head>

<body>
    <div class="course-content-wrapper">
        <div class="module-navigation">
            <a href="Module_6__Page_Object_Model.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Page Object Model
            </a>
            <a href="Module_8__Debugging_and_Troubleshooting.html" class="nav-btn next-btn">
                Next: Debugging and Troubleshooting <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <h1 id="module-7-webdriverio-with-cucumber-integration">Module 7: WebDriverIO with Cucumber Integration</h1>

        <h2 id="learning-objectives">Learning Objectives</h2>
        <p>By the end of this module, you will be able to:</p>
        <ul>
            <li>Integrate Cucumber with WebDriverIO for BDD testing</li>
            <li>Write feature files using Gherkin syntax</li>
            <li>Implement step definitions for WebDriverIO</li>
            <li>Organize and structure BDD test projects</li>
            <li>Generate comprehensive Cucumber reports</li>
            <li>Implement data-driven testing with Cucumber</li>
        </ul>

        <h2 id="introduction-to-bdd">Introduction to Behavior-Driven Development (BDD)</h2>

        <h3 id="what-is-bdd">What is BDD?</h3>
        <p>Behavior-Driven Development (BDD) is a software development approach that encourages collaboration between developers, QA, and business stakeholders. It focuses on defining the behavior of an application through examples in plain language.</p>

        <h3 id="benefits-of-bdd">Benefits of BDD with WebDriverIO</h3>
        <ul>
            <li><strong>Improved Communication:</strong> Business stakeholders can understand and contribute to test scenarios</li>
            <li><strong>Living Documentation:</strong> Feature files serve as up-to-date documentation</li>
            <li><strong>Reusable Steps:</strong> Step definitions can be reused across multiple scenarios</li>
            <li><strong>Clear Test Intent:</strong> Tests are written in natural language</li>
        </ul>

        <h2 id="setting-up-cucumber">Setting Up Cucumber with WebDriverIO</h2>

        <h3 id="installation">Installation</h3>
        <p>Install the necessary packages for Cucumber integration:</p>

        <pre><code class="language-bash"># Install Cucumber and WebDriverIO Cucumber service
npm install --save-dev @cucumber/cucumber @wdio/cucumber-framework
npm install --save-dev @wdio/spec-reporter @wdio/allure-reporter

# Install additional utilities
npm install --save-dev cucumber-html-reporter</code></pre>

        <h3 id="wdio-configuration">WebDriverIO Configuration</h3>
        <p>Configure WebDriverIO to use the Cucumber framework:</p>

        <pre><code class="language-javascript">// wdio.conf.js
exports.config = {
    // Test framework
    framework: 'cucumber',
    
    // Cucumber options
    cucumberOpts: {
        // Require files before executing features
        require: ['./features/step-definitions/**/*.js'],
        
        // Timeout for step definitions
        timeout: 60000,
        
        // Format options
        format: ['pretty'],
        
        // Fail fast
        failFast: false,
        
        // Ignore undefined definitions
        ignoreUndefinedDefinitions: false,
        
        // Tags to run
        tagExpression: 'not @skip',
        
        // Retry failed scenarios
        retry: 1
    },
    
    // Spec patterns for feature files
    specs: [
        './features/**/*.feature'
    ],
    
    // Reporters
    reporters: [
        'spec',
        ['allure', {
            outputDir: 'allure-results',
            disableWebdriverStepsReporting: true,
            disableWebdriverScreenshotsReporting: false
        }]
    ],
    
    // Hooks
    beforeScenario: function (world, context) {
        // Set up before each scenario
        console.log(`Starting scenario: ${context.pickle.name}`);
    },
    
    afterScenario: function (world, result, context) {
        // Clean up after each scenario
        if (result.status === 'FAILED') {
            // Take screenshot on failure
            const screenshot = browser.takeScreenshot();
            browser.saveScreenshot(`./screenshots/failed-${Date.now()}.png`);
        }
    }
};</code></pre>

        <h2 id="writing-feature-files">Writing Feature Files</h2>

        <h3 id="gherkin-syntax">Gherkin Syntax</h3>
        <p>Gherkin is the language used to write feature files. It uses keywords like Given, When, Then, And, But:</p>

        <pre><code class="language-gherkin"># features/login.feature
Feature: User Authentication
  As a user
  I want to be able to log in to the application
  So that I can access my account

  Background:
    Given I am on the login page

  @smoke @authentication
  Scenario: Successful login with valid credentials
    When I enter valid username "testuser@example.com"
    And I enter valid password "password123"
    And I click the login button
    Then I should be redirected to the dashboard
    And I should see a welcome message

  @authentication @negative
  Scenario: Failed login with invalid credentials
    When I enter invalid username "invalid@example.com"
    And I enter invalid password "wrongpassword"
    And I click the login button
    Then I should see an error message "Invalid credentials"
    And I should remain on the login page

  @authentication
  Scenario Outline: Login with different user types
    When I enter username "&lt;username&gt;"
    And I enter password "&lt;password&gt;"
    And I click the login button
    Then I should see "&lt;expected_result&gt;"

    Examples:
      | username           | password    | expected_result |
      | admin@example.com  | admin123    | Admin Dashboard |
      | user@example.com   | user123     | User Dashboard  |
      | guest@example.com  | guest123    | Guest Dashboard |</code></pre>

        <h3 id="feature-file-organization">Feature File Organization</h3>
        <p>Organize your feature files in a logical structure:</p>

        <pre><code class="language-text">features/
├── authentication/
│   ├── login.feature
│   ├── logout.feature
│   └── password-reset.feature
├── e-commerce/
│   ├── product-search.feature
│   ├── shopping-cart.feature
│   └── checkout.feature
├── user-management/
│   ├── user-registration.feature
│   └── profile-management.feature
└── step-definitions/
    ├── authentication/
    │   └── login-steps.js
    ├── e-commerce/
    │   └── shopping-steps.js
    └── common/
        └── common-steps.js</code></pre>

        <h2 id="implementing-step-definitions">Implementing Step Definitions</h2>

        <h3 id="basic-step-definitions">Basic Step Definitions</h3>
        <p>Implement step definitions that map Gherkin steps to WebDriverIO actions:</p>

        <pre><code class="language-javascript">// features/step-definitions/authentication/login-steps.js
const { Given, When, Then } = require('@cucumber/cucumber');

Given(/^I am on the login page$/, async () => {
    await browser.url('/login');
    await expect(browser).toHaveTitle('Login - My Application');
});

When(/^I enter valid username "([^"]*)"$/, async (username) => {
    const usernameField = await $('[data-testid="username"]');
    await usernameField.setValue(username);
});

When(/^I enter valid password "([^"]*)"$/, async (password) => {
    const passwordField = await $('[data-testid="password"]');
    await passwordField.setValue(password);
});

When(/^I enter invalid username "([^"]*)"$/, async (username) => {
    const usernameField = await $('[data-testid="username"]');
    await usernameField.setValue(username);
});

When(/^I enter invalid password "([^"]*)"$/, async (password) => {
    const passwordField = await $('[data-testid="password"]');
    await passwordField.setValue(password);
});

When(/^I click the login button$/, async () => {
    const loginButton = await $('[data-testid="login-btn"]');
    await loginButton.click();
});

Then(/^I should be redirected to the dashboard$/, async () => {
    await browser.waitUntil(
        async () => (await browser.getUrl()).includes('/dashboard'),
        {
            timeout: 5000,
            timeoutMsg: 'Expected to be redirected to dashboard'
        }
    );
});

Then(/^I should see a welcome message$/, async () => {
    const welcomeMessage = await $('[data-testid="welcome-message"]');
    await expect(welcomeMessage).toBeDisplayed();
    await expect(welcomeMessage).toHaveTextContaining('Welcome');
});

Then(/^I should see an error message "([^"]*)"$/, async (expectedMessage) => {
    const errorMessage = await $('[data-testid="error-message"]');
    await expect(errorMessage).toBeDisplayed();
    await expect(errorMessage).toHaveText(expectedMessage);
});

Then(/^I should remain on the login page$/, async () => {
    const currentUrl = await browser.getUrl();
    expect(currentUrl).toContain('/login');
});</code></pre>

        <h3 id="parameterized-steps">Parameterized Steps</h3>
        <p>Create flexible step definitions that accept parameters:</p>

        <pre><code class="language-javascript">// features/step-definitions/common/common-steps.js
const { Given, When, Then } = require('@cucumber/cucumber');

// Generic navigation step
Given(/^I navigate to "([^"]*)"$/, async (url) => {
    await browser.url(url);
});

// Generic form field interaction
When(/^I enter "([^"]*)" in the "([^"]*)" field$/, async (value, fieldName) => {
    const field = await $(`[data-testid="${fieldName}"]`);
    await field.setValue(value);
});

// Generic button click
When(/^I click the "([^"]*)" button$/, async (buttonName) => {
    const button = await $(`[data-testid="${buttonName}-btn"]`);
    await button.click();
});

// Generic text verification
Then(/^I should see "([^"]*)" on the page$/, async (expectedText) => {
    const pageText = await browser.getText('body');
    expect(pageText).toContain(expectedText);
});

// Generic element visibility check
Then(/^the "([^"]*)" element should be visible$/, async (elementName) => {
    const element = await $(`[data-testid="${elementName}"]`);
    await expect(element).toBeDisplayed();
});

// Generic element text verification
Then(/^the "([^"]*)" element should contain "([^"]*)"$/, async (elementName, expectedText) => {
    const element = await $(`[data-testid="${elementName}"]`);
    await expect(element).toHaveTextContaining(expectedText);
});</code></pre>

        <h2 id="advanced-cucumber-features">Advanced Cucumber Features</h2>

        <h3 id="data-tables">Data Tables</h3>
        <p>Use data tables for complex data input:</p>

        <pre><code class="language-gherkin"># Feature file with data table
Scenario: User registration with complete profile
  Given I am on the registration page
  When I fill in the registration form with the following details:
    | Field           | Value                |
    | First Name      | John                 |
    | Last Name       | Doe                  |
    | Email           | john.doe@example.com |
    | Phone           | +1-555-123-4567      |
    | Date of Birth   | 01/15/1990           |
    | Country         | United States        |
  And I click the register button
  Then I should see a success message</code></pre>

        <pre><code class="language-javascript">// Step definition for data table
When(/^I fill in the registration form with the following details:$/, async (dataTable) => {
    const data = dataTable.rowsHash();
    
    for (const [field, value] of Object.entries(data)) {
        const fieldSelector = getFieldSelector(field);
        const fieldElement = await $(fieldSelector);
        await fieldElement.setValue(value);
    }
});

function getFieldSelector(fieldName) {
    const fieldMap = {
        'First Name': '[data-testid="first-name"]',
        'Last Name': '[data-testid="last-name"]',
        'Email': '[data-testid="email"]',
        'Phone': '[data-testid="phone"]',
        'Date of Birth': '[data-testid="dob"]',
        'Country': '[data-testid="country"]'
    };
    
    return fieldMap[fieldName] || `[data-testid="${fieldName.toLowerCase().replace(/\s+/g, '-')}"]`;
}</code></pre>

        <h3 id="hooks">Hooks</h3>
        <p>Implement hooks for setup and teardown operations:</p>

        <pre><code class="language-javascript">// features/step-definitions/hooks.js
const { Before, After, BeforeAll, AfterAll } = require('@cucumber/cucumber');

BeforeAll(async () => {
    console.log('Setting up test environment...');
    // Global setup operations
});

Before(async (scenario) => {
    console.log(`Starting scenario: ${scenario.pickle.name}`);
    
    // Clear browser storage before each scenario
    await browser.execute(() => {
        localStorage.clear();
        sessionStorage.clear();
    });
    
    // Set browser window size
    await browser.setWindowSize(1920, 1080);
});

Before({ tags: '@database' }, async () => {
    // Setup specific to scenarios tagged with @database
    console.log('Setting up database for scenario...');
    // Database setup operations
});

After(async (scenario) => {
    if (scenario.result.status === 'FAILED') {
        // Take screenshot on failure
        const screenshot = await browser.takeScreenshot();
        await browser.saveScreenshot(`./screenshots/failed-${scenario.pickle.name}-${Date.now()}.png`);
        
        // Attach screenshot to Allure report
        if (typeof allure !== 'undefined') {
            allure.addAttachment('Screenshot', screenshot, 'image/png');
        }
    }
});

AfterAll(async () => {
    console.log('Cleaning up test environment...');
    // Global cleanup operations
});</code></pre>

        <h2 id="page-object-integration">Page Object Integration</h2>

        <h3 id="using-page-objects-with-cucumber">Using Page Objects with Cucumber</h3>
        <p>Integrate Page Object Model with Cucumber step definitions:</p>

        <pre><code class="language-javascript">// pages/LoginPage.js
class LoginPage {
    get usernameField() { return $('[data-testid="username"]'); }
    get passwordField() { return $('[data-testid="password"]'); }
    get loginButton() { return $('[data-testid="login-btn"]'); }
    get errorMessage() { return $('[data-testid="error-message"]'); }

    async open() {
        await browser.url('/login');
    }

    async login(username, password) {
        await this.usernameField.setValue(username);
        await this.passwordField.setValue(password);
        await this.loginButton.click();
    }

    async getErrorMessage() {
        await this.errorMessage.waitForDisplayed();
        return await this.errorMessage.getText();
    }
}

module.exports = new LoginPage();</code></pre>

        <pre><code class="language-javascript">// features/step-definitions/authentication/login-steps.js
const { Given, When, Then } = require('@cucumber/cucumber');
const LoginPage = require('../../../pages/LoginPage');
const DashboardPage = require('../../../pages/DashboardPage');

Given(/^I am on the login page$/, async () => {
    await LoginPage.open();
});

When(/^I login with username "([^"]*)" and password "([^"]*)"$/, async (username, password) => {
    await LoginPage.login(username, password);
});

Then(/^I should be on the dashboard$/, async () => {
    await expect(DashboardPage.welcomeMessage).toBeDisplayed();
});

Then(/^I should see login error "([^"]*)"$/, async (expectedError) => {
    const actualError = await LoginPage.getErrorMessage();
    expect(actualError).toBe(expectedError);
});</code></pre>

        <h2 id="reporting">Reporting</h2>

        <h3 id="cucumber-html-reports">Cucumber HTML Reports</h3>
        <p>Generate comprehensive HTML reports for Cucumber tests:</p>

        <pre><code class="language-javascript">// generate-report.js
const reporter = require('cucumber-html-reporter');

const options = {
    theme: 'bootstrap',
    jsonFile: 'reports/cucumber-report.json',
    output: 'reports/cucumber-report.html',
    reportSuiteAsScenarios: true,
    scenarioTimestamp: true,
    launchReport: true,
    metadata: {
        "App Version": "1.0.0",
        "Test Environment": "STAGING",
        "Browser": "Chrome 91",
        "Platform": "Windows 10",
        "Parallel": "Scenarios",
        "Executed": "Remote"
    }
};

reporter.generate(options);</code></pre>

        <h3 id="allure-integration">Allure Integration</h3>
        <p>Enhance Cucumber reports with Allure:</p>

        <pre><code class="language-javascript">// features/step-definitions/allure-steps.js
const { Given, When, Then } = require('@cucumber/cucumber');
const allure = require('@wdio/allure-reporter').default;

Given(/^I am on the login page$/, async () => {
    allure.addStep('Navigate to login page', async () => {
        await browser.url('/login');
    });
    
    allure.addStep('Verify login page is loaded', async () => {
        await expect(browser).toHaveTitle('Login - My Application');
    });
});

When(/^I perform login with "([^"]*)" and "([^"]*)"$/, async (username, password) => {
    allure.addStep(`Enter username: ${username}`, async () => {
        await $('[data-testid="username"]').setValue(username);
    });
    
    allure.addStep('Enter password', async () => {
        await $('[data-testid="password"]').setValue(password);
    });
    
    allure.addStep('Click login button', async () => {
        await $('[data-testid="login-btn"]').click();
    });
});</code></pre>

        <h2 id="best-practices">Best Practices</h2>

        <h3 id="writing-good-scenarios">Writing Good Scenarios</h3>
        <ul>
            <li><strong>Keep scenarios focused:</strong> Each scenario should test one specific behavior</li>
            <li><strong>Use descriptive names:</strong> Scenario names should clearly describe what is being tested</li>
            <li><strong>Follow Given-When-Then structure:</strong> Maintain clear separation between setup, action, and verification</li>
            <li><strong>Avoid implementation details:</strong> Focus on behavior, not technical implementation</li>
        </ul>

        <h3 id="step-definition-best-practices">Step Definition Best Practices</h3>
        <ul>
            <li><strong>Reuse steps:</strong> Create generic, reusable step definitions</li>
            <li><strong>Keep steps atomic:</strong> Each step should perform one clear action</li>
            <li><strong>Use meaningful parameter names:</strong> Make step definitions self-documenting</li>
            <li><strong>Handle waits properly:</strong> Implement appropriate waiting strategies</li>
        </ul>

        <h2 id="practical-exercise">Practical Exercise</h2>

        <div class="practical-exercise">
            <h3>Exercise: E-commerce BDD Test Suite</h3>
            <p><strong>Objective:</strong> Create a comprehensive BDD test suite for an e-commerce application using Cucumber and WebDriverIO.</p>
            
            <h4>Requirements:</h4>
            <ol>
                <li>Create feature files for:
                    <ul>
                        <li>User registration and login</li>
                        <li>Product search and filtering</li>
                        <li>Shopping cart operations</li>
                        <li>Checkout process</li>
                    </ul>
                </li>
                <li>Implement corresponding step definitions</li>
                <li>Use data tables and scenario outlines</li>
                <li>Integrate with Page Object Model</li>
                <li>Set up proper hooks for test setup/teardown</li>
                <li>Generate HTML and Allure reports</li>
            </ol>

            <h4>Deliverables:</h4>
            <ul>
                <li>Feature files with comprehensive scenarios</li>
                <li>Step definition files</li>
                <li>Page object classes</li>
                <li>WebDriverIO configuration for Cucumber</li>
                <li>Reporting setup and generated reports</li>
            </ul>
        </div>

        <h2 id="summary">Summary</h2>
        <p>In this module, you've learned how to integrate Cucumber with WebDriverIO for behavior-driven development. You now understand how to:</p>
        <ul>
            <li>Set up Cucumber with WebDriverIO</li>
            <li>Write effective feature files using Gherkin syntax</li>
            <li>Implement reusable step definitions</li>
            <li>Use advanced Cucumber features like data tables and hooks</li>
            <li>Integrate BDD tests with Page Object Model</li>
            <li>Generate comprehensive test reports</li>
        </ul>

        <p>BDD with Cucumber provides a powerful way to create tests that serve as living documentation and facilitate collaboration between technical and non-technical team members.</p>

        <div class="module-navigation">
            <a href="Module_6__Page_Object_Model.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Page Object Model
            </a>
            <a href="Module_8__Debugging_and_Troubleshooting.html" class="nav-btn next-btn">
                Next: Debugging and Troubleshooting <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            hljs.highlightAll();
        });
    </script>
</body>
</html>

