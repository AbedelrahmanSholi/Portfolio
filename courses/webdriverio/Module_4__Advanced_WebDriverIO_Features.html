<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://unpkg.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), speaker=()">

    <link rel="stylesheet" href="../../css/courses/course_portfolio_style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 4: Advanced WebDriverIO Features</title>
    <link rel="stylesheet" href="../../css/courses/enhanced_course_styling.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="../../js/courses/mermaid_loader.js"></script>
</head>

<body>
    <div class="course-content-wrapper">
        <div class="module-navigation">
            <a href="Module_2__Selectors_and_Element_Interactions.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Asynchronous Testing with WebDriverIO
            </a>
            <a href="Module_5__API_Testing_with_WebDriverIO.html" class="nav-btn next-btn">
                Next: API Testing with WebDriverIO <i class="fas fa-chevron-right"></i>
            </a>
        </div>

        <h1 id="module-4-advanced-webdriverio-features">Module 4: Advanced WebDriverIO Features</h1>

        <h2 id="learning-objectives">Learning Objectives</h2>
        <ul>
            <li>Master advanced WebDriverIO configuration options</li>
            <li>Implement custom commands and services</li>
            <li>Handle complex browser interactions</li>
            <li>Optimize test execution with parallel testing</li>
            <li>Integrate with CI/CD pipelines</li>
        </ul>

        <h2 id="41-advanced-configuration">4.1 Advanced Configuration</h2>

        <h3 id="multi-browser-configuration">Multi-Browser Configuration</h3>
        <p>Configure WebDriverIO to run tests across multiple browsers simultaneously.</p>

        <pre><code>// wdio.conf.js
exports.config = {
    capabilities: [
        {
            browserName: 'chrome',
            'goog:chromeOptions': {
                args: ['--headless', '--disable-gpu', '--window-size=1920,1080']
            }
        },
        {
            browserName: 'firefox',
            'moz:firefoxOptions': {
                args: ['-headless']
            }
        },
        {
            browserName: 'safari'
        }
    ],
    
    // Parallel execution
    maxInstances: 3,
    
    // Services
    services: [
        'chromedriver',
        'geckodriver',
        'safaridriver'
    ]
};
</code></pre>

        <h3 id="environment-specific-configuration">Environment-Specific Configuration</h3>
        <pre><code>// wdio.conf.js
const baseUrl = process.env.NODE_ENV === 'production' 
    ? 'https://prod.example.com' 
    : 'https://staging.example.com';

exports.config = {
    baseUrl: baseUrl,
    
    // Environment-specific capabilities
    capabilities: process.env.CI ? [
        // CI configuration
        {
            browserName: 'chrome',
            'goog:chromeOptions': {
                args: ['--headless', '--no-sandbox', '--disable-dev-shm-usage']
            }
        }
    ] : [
        // Local development configuration
        {
            browserName: 'chrome',
            'goog:chromeOptions': {
                args: ['--window-size=1920,1080']
            }
        }
    ]
};
</code></pre>

        <h2 id="42-custom-commands">4.2 Custom Commands</h2>

        <h3 id="browser-custom-commands">Browser Custom Commands</h3>
        <p>Create reusable custom commands to extend WebDriverIO functionality.</p>

        <pre><code>// commands/customCommands.js
browser.addCommand('loginAs', async function (username, password) {
    await $('#username').setValue(username);
    await $('#password').setValue(password);
    await $('#login-button').click();
    
    // Wait for login to complete
    await browser.waitUntil(async () => {
        const url = await browser.getUrl();
        return url.includes('/dashboard');
    }, {
        timeout: 10000,
        timeoutMsg: 'Login was not successful'
    });
});

// Usage in tests
describe('Dashboard Tests', () => {
    it('should access dashboard after login', async () => {
        await browser.url('/login');
        await browser.loginAs('testuser', 'password123');
        
        const title = await browser.getTitle();
        expect(title).toContain('Dashboard');
    });
});
</code></pre>

        <h3 id="element-custom-commands">Element Custom Commands</h3>
        <pre><code>// Element-specific custom commands
browser.addCommand('waitAndClick', async function () {
    await this.waitForClickable({ timeout: 5000 });
    await this.click();
}, true); // true indicates this is an element command

browser.addCommand('setValueAndVerify', async function (value) {
    await this.setValue(value);
    const actualValue = await this.getValue();
    expect(actualValue).toBe(value);
}, true);

// Usage
describe('Form Tests', () => {
    it('should interact with form elements', async () => {
        await $('#submit-button').waitAndClick();
        await $('#input-field').setValueAndVerify('test value');
    });
});
</code></pre>

        <h2 id="43-advanced-browser-interactions">4.3 Advanced Browser Interactions</h2>

        <h3 id="window-and-tab-management">Window and Tab Management</h3>
        <pre><code>describe('Multi-Window Tests', () => {
    it('should handle multiple windows', async () => {
        // Open new window
        await browser.newWindow('https://example.com');
        
        // Get all window handles
        const handles = await browser.getWindowHandles();
        expect(handles).toHaveLength(2);
        
        // Switch between windows
        await browser.switchToWindow(handles[0]);
        const title1 = await browser.getTitle();
        
        await browser.switchToWindow(handles[1]);
        const title2 = await browser.getTitle();
        
        // Close current window
        await browser.closeWindow();
        
        // Switch back to original window
        await browser.switchToWindow(handles[0]);
    });
});
</code></pre>

        <h3 id="iframe-handling">iFrame Handling</h3>
        <pre><code>describe('iFrame Tests', () => {
    it('should interact with iframe content', async () => {
        // Switch to iframe
        const iframe = await $('#my-iframe');
        await browser.switchToFrame(iframe);
        
        // Interact with elements inside iframe
        await $('#iframe-button').click();
        const text = await $('#iframe-text').getText();
        
        // Switch back to main frame
        await browser.switchToFrame(null);
        
        // Verify main page content
        const mainTitle = await $('h1').getText();
        expect(mainTitle).toContain('Main Page');
    });
});
</code></pre>

        <h2 id="44-performance-optimization">4.4 Performance Optimization</h2>

        <h3 id="parallel-test-execution">Parallel Test Execution</h3>
        <pre><code>// wdio.conf.js
exports.config = {
    // Maximum number of total parallel running workers
    maxInstances: 5,
    
    // Maximum number of parallel sessions per capability
    capabilities: [{
        browserName: 'chrome',
        maxInstances: 3
    }],
    
    // Optimize for CI environments
    bail: process.env.CI ? 1 : 0, // Stop after first failure in CI
    
    // Timeouts
    connectionRetryTimeout: 120000,
    connectionRetryCount: 3,
    
    // Reporters for parallel execution
    reporters: [
        'spec',
        ['allure', {
            outputDir: 'allure-results',
            disableWebdriverStepsReporting: true,
            disableWebdriverScreenshotsReporting: false
        }]
    ]
};
</code></pre>

        <h3 id="test-data-management">Test Data Management</h3>
        <pre><code>// utils/testDataManager.js
class TestDataManager {
    static async createTestUser() {
        const timestamp = Date.now();
        return {
            username: `testuser_${timestamp}`,
            email: `test_${timestamp}@example.com`,
            password: 'TestPassword123!'
        };
    }
    
    static async cleanupTestData(userId) {
        // API call to cleanup test data
        await browser.call(async () => {
            const response = await fetch(`/api/users/${userId}`, {
                method: 'DELETE',
                headers: { 'Authorization': 'Bearer ' + process.env.API_TOKEN }
            });
            return response.ok;
        });
    }
}

// Usage in tests
describe('User Management', () => {
    let testUser;
    
    beforeEach(async () => {
        testUser = await TestDataManager.createTestUser();
    });
    
    afterEach(async () => {
        if (testUser.id) {
            await TestDataManager.cleanupTestData(testUser.id);
        }
    });
    
    it('should create new user', async () => {
        await browser.url('/register');
        await $('#username').setValue(testUser.username);
        await $('#email').setValue(testUser.email);
        await $('#password').setValue(testUser.password);
        await $('#register-button').click();
        
        await expect($('.success-message')).toBeDisplayed();
    });
});
</code></pre>

        <h2 id="45-debugging-and-troubleshooting">4.5 Debugging and Troubleshooting</h2>

        <h3 id="debug-mode">Debug Mode</h3>
        <pre><code>describe('Debug Example', () => {
    it('should debug test execution', async () => {
        await browser.url('/complex-page');
        
        // Pause execution for debugging
        await browser.debug();
        
        // Take screenshot for debugging
        await browser.saveScreenshot('./debug-screenshot.png');
        
        // Log browser console messages
        const logs = await browser.getLogs('browser');
        console.log('Browser logs:', logs);
        
        // Execute JavaScript for debugging
        const result = await browser.execute(() => {
            return {
                url: window.location.href,
                title: document.title,
                readyState: document.readyState
            };
        });
        console.log('Page info:', result);
    });
});
</code></pre>

        <h3 id="error-handling">Error Handling</h3>
        <pre><code>describe('Error Handling', () => {
    it('should handle errors gracefully', async () => {
        try {
            await browser.url('/page-that-might-not-exist');
            await $('#element-that-might-not-exist').click();
        } catch (error) {
            // Take screenshot on error
            await browser.saveScreenshot('./error-screenshot.png');
            
            // Log additional debugging information
            const url = await browser.getUrl();
            const title = await browser.getTitle();
            
            console.log(`Error occurred on page: ${url}`);
            console.log(`Page title: ${title}`);
            console.log(`Error details: ${error.message}`);
            
            // Re-throw error to fail the test
            throw error;
        }
    });
});
</code></pre>

        <div class="module-navigation">
            <a href="Module_2__Selectors_and_Element_Interactions.html" class="nav-btn prev-btn">
                <i class="fas fa-chevron-left"></i> Previous: Asynchronous Testing with WebDriverIO
            </a>
            <a href="Module_5__API_Testing_with_WebDriverIO.html" class="nav-btn next-btn">
                Next: API Testing with WebDriverIO <i class="fas fa-chevron-right"></i>
            </a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script src="/js/courses/mermaid_loader.js"></script>
    <script src="/js/courses/mermaid_renderer.js"></script>
    <script src="/js/courses/content_loader.js"></script>
    <script src="/js/courses/diagram_loader.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Highlight code blocks
            document.querySelectorAll("pre code").forEach((block) => {
                hljs.highlightBlock(block);
            });

            // Initialize Mermaid diagrams
            if (typeof mermaid !== "undefined") {
                mermaid.initialize({
                    startOnLoad: true,
                    theme: "dark",
                    securityLevel: "loose",
                    themeVariables: {
                        primaryColor: "#3498db",
                        primaryTextColor: "#fff",
                        primaryBorderColor: "#1f77b4",
                        lineColor: "#f8f9fa",
                        secondaryColor: "#6c757d",
                        tertiaryColor: "#2c3e50"
                    }
                });
            }
        });
    </script>
    <script src="../../js/courses/mermaid_enhanced.js"></script>
</body>
</html>

